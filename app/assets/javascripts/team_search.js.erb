$(document).ready(function () {
  $(".team_name").autocomplete({
    source: function (request, response) {
      $.getJSON("/teams/search", {
        name: request.term,
      }, response );
    },
    minLength: 2,
    select: function(event, ui) {
      var logoElement = $(this).closest(".team_details").find(".logo img");
      var scoreLogoElement = $(this).closest("#match_form").find(".match_score");

      if ($(this).attr("id") == "match_home_team_name") {
        scoreLogoElement = $(scoreLogoElement).find(".home_team_logo img");
      }
      else {
        scoreLogoElement = $(scoreLogoElement).find(".away_team_logo img");
      }

      $(logoElement).hide().attr("src", ui.item.logo).fadeIn();
      $(scoreLogoElement).hide().attr("src", ui.item.logo_thumb).fadeIn();

      $(this).closest(".team_details").find(".team_id").val(ui.item.id);
    },
    search: function () {
      $(this).closest(".form-group").find(".lens").hide();
      $(this).closest(".team_details").find(".loading").show();
    },
    open: function () {
      $(this).closest(".form-group").find(".lens").show();
      $(this).closest(".team_details").find(".loading").hide();
    },
    response: function(event, ui) {
      if (!ui.content.length) {
        var noResult = { value: "no-results" };
        ui.content.push(noResult);
      }
    }
  })
  .each(function (i) {
    $(this).data("ui-autocomplete")._renderItem = function(ul, item) {
      if (item.value == "no-results") {
        return $( "<li> ").append("<span class='padder'><%= I18n.t('no_results') %></span>").appendTo(ul);
      }
      return $( "<li>" )
        .append( "<a> <img src='" + item.logo_mini + "'></img>" + item.name + "</a>" )
        .appendTo( ul );
    };
  });
});